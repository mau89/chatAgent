#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Telegram Chat Agent

echo "ü§ñ –ó–∞–ø—É—Å–∫ Telegram Chat Agent..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ .env —Ñ–∞–π–ª–∞
if [ ! -f .env ]; then
    echo "‚ö†Ô∏è  –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω."
    echo "üìù –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:"
    echo "   1. –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å DeepSeek (–±–µ—Å–ø–ª–∞—Ç–Ω–æ!)"
    echo "   2. –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç (–±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö API)"
    echo "   3. –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞"
    echo ""
    read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä (1-3): " choice
    
    case $choice in
        1)
            echo "üöÄ –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ —Å DeepSeek..."
            cp quick_start.env .env
            echo "üìù –û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å:"
            echo "   - TELEGRAM_BOT_TOKEN (–ø–æ–ª—É—á–∏—Ç—å —É @BotFather)"
            echo "   - DEEPSEEK_API_KEY (–ø–æ–ª—É—á–∏—Ç—å –Ω–∞ https://platform.deepseek.com/)"
            ;;
        2)
            echo "üîß –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞..."
            cp config.env.example .env
            echo "üìù –î–æ–±–∞–≤—å—Ç–µ TELEGRAM_BOT_TOKEN –≤ .env —Ñ–∞–π–ª"
            echo "   –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ USE_DEEPSEEK=false"
            ;;
        3)
            echo "‚öôÔ∏è  –ö–æ–ø–∏—Ä—É–µ–º –ø–æ–ª–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é..."
            cp config.env.example .env
            echo "üìù –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DeepSeek –≤ .env —Ñ–∞–π–ª–µ"
            echo "   –°–º. DEEPSEEK_SETUP.md"
            ;;
        *)
            echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –ö–æ–ø–∏—Ä—É–µ–º –±–∞–∑–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é..."
            cp config.env.example .env
            ;;
    esac
    
    echo ""
    echo "üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:"
    echo "   - README.md - –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
    echo "   - DEEPSEEK_SETUP.md - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ DeepSeek"
    echo ""
    echo "üîß –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ .env —Ñ–∞–π–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ: ./run.sh"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
if ! grep -q "TELEGRAM_BOT_TOKEN=your_bot_token_here" .env; then
    echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞"
else
    echo "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ TELEGRAM_BOT_TOKEN –≤ —Ñ–∞–π–ª–µ .env"
    exit 1
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
go mod tidy

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞..."
go run .

